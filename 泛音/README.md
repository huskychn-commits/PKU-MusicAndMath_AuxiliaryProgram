# 泛音 - 管乐器声学模拟与可视化工具集

本文件夹包含用于管乐器声学模拟、形状设计和有限元分析的一系列Python工具。这些工具主要用于研究喇叭形状对声学特性的影响，通过Webster方程求解本征频率和模式。

## 文件说明

### 主要程序文件

1. **make_tube.py** - 管状形状设计器
   - 图形界面程序，用于交互式设计喇叭形状
   - 功能特点：
     - 在绘图区域添加和拖动点（限制在X>0, Y>0区域）
     - 自动根据点位置进行样条插值（二次/三次函数）
     - 支持边界条件设置：左/右边界闭合、辐射阻抗
     - 存储设计结果到`temp/tube_function.py`和`temp/tube_settings.txt`
   - 使用方法：直接运行`python make_tube.py`

2. **draw_tube.py** - 管状形状可视化工具
   - 绘制由`make_tube.py`创建的管状形状
   - 功能特点：
     - 显示管状形状函数曲线
     - 确保y=0轴在图上可见（函数正定性要求）
     - 图像不会顶到最上面，留有适当边距
   - 使用方法：`python draw_tube.py [--num-points N] [--title "标题"] [--no-show]`

3. **webster_fem_solver.py** - Webster方程有限元求解器
   - 求解Webster方程：d/dx [S(x) dp/dx] + k² S(x) p = 0
   - 功能特点：
     - 支持不同边界条件（开口/闭口）组合
     - 计算前10个本征频率和模式
     - 可视化结果：频率数轴图（含f/f₀顶部轴）和前5个模式波形
     - 顶部轴显示相对频率f/f₀，刻度线每1单位，标签每5单位，灰色显示
   - 使用方法：运行后按提示选择边界条件类型

4. **喇叭方程FEM，简单边界，未排除奇异.py** - Webster方程FEM求解器（早期版本）
   - Webster方程的有限元实现，处理简单边界条件

### 支持文件

5. **temp/tube_function.py** - 存储的管状形状函数
   - 由`make_tube.py`自动生成
   - 包含`tube_shape(x)`函数，输入x∈[0,1]，输出对应的Y坐标
   - 使用样条插值，可微分

6. **temp/tube_settings.txt** - 存储的边界条件设置
   - 存储三个布尔值：左边界闭合、右边界闭合、辐射阻抗

7. **管乐器中一维声压场的数学推导.md** - 理论文档
   - 包含圆形平面活塞模型的数学推导
   - 详细说明声压场的求解过程

8. **quest.txt** - 开发任务描述
   - 记录各个程序的开发需求和功能说明

## 依赖项

- Python 3.7+
- NumPy
- SciPy
- Matplotlib
- Scipy.special（用于特殊函数计算）

安装依赖：
```bash
pip install numpy scipy matplotlib
```

## 使用流程

### 1. 设计喇叭形状
```bash
cd 泛音
python make_tube.py
```
- 在图形界面中添加点并调整形状
- 设置边界条件
- 点击"Store"按钮保存设计

### 2. 可视化喇叭形状
```bash
python draw_tube.py
```
- 显示设计的喇叭形状
- 确保y=0轴可见，图像布局合理

### 3. 声学特性分析
```bash
python webster_fem_solver.py
```
- 选择边界条件类型（1-4）
- 程序将计算并显示：
  - 前10个本征频率
  - 频率数轴图（底部：频率，顶部：f/f₀）
  - 前5个模式的压力分布波形

## 功能特点

### 图形界面设计
- 交互式点编辑和拖动
- 实时样条插值更新
- 边界条件可视化

### 数值计算
- 有限元方法求解Webster方程
- 支持多种边界条件组合
- 自动验证模式有效性

### 可视化
- 双轴频率显示（频率 + 相对频率）
- 合理的坐标轴范围和边距
- 清晰的模式波形展示

## 注意事项

1. `make_tube.py`设计的点必须位于X>0, Y>0区域
2. `draw_tube.py`确保函数正定性，y=0轴始终可见
3. `webster_fem_solver.py`的顶部轴使用灰色，刻度线每1单位，标签每5单位
4. 运行前确保`temp/tube_function.py`存在（由`make_tube.py`生成）
5. **当前实现的局限性**：`webster_fem_solver.py`采用了过度简化的边界条件（仅支持理想的开口/闭口边界），因此求解得到的本征频率和波形存在一定误差。实际喇叭边界应包含辐射阻抗效应，这会影响频率和模式的准确性。
6. **下一步改进方向**：利用`draw_tube.py`中的`radiation_impedance()`函数计算更准确的边界条件，将辐射阻抗纳入Webster方程的求解过程，从而获得更精确的频谱特性。

## 理论背景

这些工具基于以下声学理论：
- Webster喇叭方程
- 有限元方法
- 样条插值技术
- 圆形平面活塞辐射模型

详细理论推导参见`管乐器中一维声压场的数学推导.md`。

## 作者与许可

本项目为北京大学"音乐与数学"课程作业的一部分。
代码可根据需要修改和使用。
